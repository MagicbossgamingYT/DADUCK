<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Application</title>
    <link rel="stylesheet" href="https://chessboardjs.com/dist/chessboard-1.0.0.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            text-align: center;
        }
        .board {
            width: 400px;
            margin: auto;
        }
        .info {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h1>Chess Application</h1>
<div id="board" class="board"></div>
<br>
<div class="info">
    <button id="reset">Reset</button>
    <div id="move-history" class="move-history"></div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script src="https://chessboardjs.com/dist/chessboard-1.0.0.min.js"></script>
<script>
    var board,
        game = new Chess();

    // Piece values
    var pieceValues = {
        'p': 1,  // Pawn
        'r': 5,  // Rook
        'n': 3,  // Knight
        'b': 3,  // Bishop
        'q': 9,  // Queen
        'k': 0   // King (not evaluated)
    };

    // Function to evaluate the position
    function evaluatePosition() {
        var totalValue = 0;
        for (var piece in game.board()) {
            for (var rank = 0; rank < 8; rank++) {
                for (var file = 0; file < 8; file++) {
                    var square = game.board()[rank][file];
                    if (square) {
                        var pieceValue = pieceValues[square.type];
                        if (square.color === 'w') {
                            totalValue += pieceValue;
                        } else {
                            totalValue -= pieceValue;
                        }
                    }
                }
            }
        }
        return totalValue;
    }

    // Function to get the best move based on evaluation
    function getBestMove() {
        var legalMoves = game.ugly_moves();
        var bestMove = null;
        var bestValue = -Infinity;

        for (var i = 0; i < legalMoves.length; i++) {
            var move = legalMoves[i];
            game.ugly_move(move);
            var value = evaluatePosition();
            game.undo();

            if (value > bestValue) {
                bestValue = value;
                bestMove = move;
            }
        }

        return bestMove;
    }

    function makeBestMove() {
        var bestMove = getBestMove();
        if (bestMove) {
            game.move(bestMove);
            board.position(game.fen());
            renderMoveHistory(game.history());
        }
    }

    function renderMoveHistory(moves) {
        var historyElement = $('#move-history').empty();
        historyElement.append(moves.join(', '));
    }

    var cfg = {
        draggable: true,
        position: 'start',
        onDrop: function(source, target) {
            var move = game.move({
                from: source,
                to: target,
                promotion: 'q'
            });

            if (move === null) return 'snapback';

            renderMoveHistory(game.history());
            makeBestMove(); // AI makes a move
        },
    };
    
    board = ChessBoard('board', cfg);

    $('#reset').on('click', function() {
        game.reset();
        board.start();
        $('#move-history').empty();
    });
</script>

</body>
</html>
